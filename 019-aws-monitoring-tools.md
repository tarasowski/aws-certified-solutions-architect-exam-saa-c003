# AWS Monitoring Tools

# CloudWatch Metrics

**Overview:**
Amazon CloudWatch Metrics is a comprehensive monitoring service that provides insights into the performance and health of various AWS resources. It offers a wide range of metrics for monitoring different aspects of AWS services, enabling users to track variables such as CPU usage, network activity, and more. CloudWatch Metrics organizes metrics into namespaces and allows users to define dimensions, which are attributes associated with metrics (e.g., instance ID, environment). Users can create CloudWatch dashboards to visualize metrics and gain insights into resource performance. Additionally, CloudWatch supports custom metrics creation, allowing users to monitor specific aspects of their resources, such as RAM usage. CloudWatch Metrics also offers the flexibility to stream metrics to various destinations in near real-time, including Amazon S3, Amazon Redshift, Amazon OpenSearch, or third-party services like Datadog, New Relic, or Splunk. Users can filter and send only relevant metrics to these destinations, optimizing data transfer and storage costs.

**Key Features:**
- Provides metrics for monitoring the performance and health of AWS resources.
- Metrics represent variables such as CPU usage, network activity, and more.
- Metrics are organized into namespaces and can have dimensions (attributes).
- Supports up to 30 dimensions per metric.
- Metrics include timestamps for tracking changes over time.
- Enables the creation of CloudWatch dashboards for visualizing metrics.
- Supports custom metrics creation for monitoring specific resource attributes (e.g., RAM usage).
- Offers near real-time streaming of metrics to various destinations like S3, Redshift, OpenSearch, or third-party services.
- Allows users to filter and send only relevant metrics to destinations, optimizing data transfer and storage costs.
- Automatically collects basic metrics at five-minute intervals for AWS services like EC2, with the option to enable detailed monitoring for more frequent data collection.

CloudWatch Metrics provides a powerful monitoring solution for AWS resources, offering flexibility, scalability, and real-time insights into resource performance and health. By leveraging CloudWatch Metrics, users can effectively monitor, troubleshoot, and optimize their AWS infrastructure to ensure optimal performance and reliability.

# CloudWatch Logs

**Overview:**
Amazon CloudWatch Logs is a comprehensive log management and monitoring service provided by AWS. It enables users to collect, store, and analyze log data generated by various AWS resources and applications. CloudWatch Logs organizes log data into log groups, each representing a specific application or system component, and within log groups, logs are further divided into log streams, which correspond to individual instances, log files, or containers. Users can define log expiration policies to control how long log data is retained, ranging from never expiring to retention periods of 1 day to 10 years. CloudWatch Logs offers various integration options to send log data to other AWS services like Amazon S3, Kinesis Data Streams, Kinesis Data Firehose, AWS Lambda, and Amazon OpenSearch Service.

**Key Features:**
- **Log Groups:** Represents the name of an application or system component.
- **Log Streams:** Instances within an application, log files, or containers.
- **Log Expiration Policies:** Define how long log data is retained, ranging from never expiring to specified retention periods.
- **Integration Options:** CloudWatch Logs can send log data to various AWS services including Amazon S3, Kinesis Data Streams, Kinesis Data Firehose, AWS Lambda, and Amazon OpenSearch Service.
- **Encryption:** Log data is encrypted by default, and users can set up KMS-based encryption using their own keys for additional security.
- **CloudWatch Logs Insights:** A query engine for analyzing log data, enabling users to run queries and save them for future use. It's not a real-time engine but provides insights into historical log data.
- **Export to S3:** Log data can be exported to Amazon S3 for long-term storage, but the export process can take up to 12 hours and requires calling the `CreateExportTask` API.
- **Real-time Export:** For real-time log data export, users can utilize logs subscription to send data to streams, Firehose, or Lambda.
- **Subscription Filters:** Use subscription filters to filter log data delivered to destinations based on specified criteria.
- **Cross-Account Data Aggregation:** CloudWatch Logs can aggregate log data from multiple AWS accounts via Kinesis Data Streams using cross-account subscriptions.
- **Alarms:** Users can create alarms based on metric values derived from log data, enabling proactive monitoring and alerting for critical events.

CloudWatch Logs provides essential capabilities for centralized log management, enabling users to effectively monitor, troubleshoot, and analyze log data from various AWS resources and applications. With features like encryption, real-time export, and query capabilities, CloudWatch Logs offers a robust solution for log management and monitoring in AWS environments.

# CloudWatch LiveTail

**Overview:**
Amazon CloudWatch LiveTail is a feature that allows users to monitor log events in real-time by streaming log data directly to their terminal. It offers a similar experience to using the `tail -f` command on Linux systems, providing continuous updates of log events that match the specified filter. With CloudWatch LiveTail, users can stay informed about log events as they occur, enabling real-time monitoring and troubleshooting of applications and systems.

**Key Features:**
- **Real-time Log Monitoring:** CloudWatch LiveTail provides real-time streaming of log events directly to the user's terminal.
- **Continuous Updates:** Log events that match the specified filter are continuously streamed to the terminal, providing up-to-date information as it occurs.
- **Similar to `tail -f` Command:** CloudWatch LiveTail offers a similar experience to using the `tail -f` command on Linux systems, allowing users to monitor log files as they are updated.
- **Filtering:** Users can specify filters to narrow down the log events they want to monitor, ensuring that they receive relevant information.
- **Cost Consideration:** It's important to note that while CloudWatch LiveTail provides real-time log monitoring capabilities, users should be mindful of the associated costs, as streaming log data in real-time can incur charges. Users should cancel the LiveTail session when it's no longer needed to avoid unnecessary costs.

CloudWatch LiveTail offers a convenient way to monitor log events in real-time, providing users with valuable insights into the behavior and performance of their applications and systems. By streaming log data directly to the terminal and offering filtering capabilities, CloudWatch LiveTail enables efficient troubleshooting and monitoring, helping users quickly identify and address issues as they arise. However, users should be mindful of cost considerations and cancel LiveTail sessions when they are no longer needed to avoid unnecessary charges.

# CloudWatch Logs for EC2 (Agent)

**Overview:**
Amazon CloudWatch Logs for EC2 enables users to collect and monitor log data from Amazon Elastic Compute Cloud (EC2) instances. By default, log data from EC2 instances is not sent to CloudWatch Logs. To enable log collection, users need to install and configure the CloudWatch Logs agent on their EC2 instances. The agent is responsible for pushing log files from the EC2 instances to CloudWatch Logs for centralized storage and monitoring. It's important to ensure that the necessary IAM permissions are set up to allow the agent to access CloudWatch Logs.

**Key Features:**
- **CloudWatch Logs Agent:** Users need to install and configure the CloudWatch Logs agent on their EC2 instances to push log files to CloudWatch Logs.
- **IAM Permissions:** Ensure that the IAM permissions are properly configured to allow the agent to access CloudWatch Logs.
- **On-Premises Support:** The CloudWatch Logs agent can also be set up on on-premises servers to collect and send log data to CloudWatch Logs.
- **Unified Agent:** The CloudWatch unified agent can collect not only log data but also additional system-level metrics such as CPU utilization, disk usage, network activity, and RAM usage.
- **Centralized Configuration:** Users can centrally manage the configuration of the CloudWatch Logs agent using AWS Systems Manager Parameter Store.
- **Out-of-the-Box Metrics:** CloudWatch automatically collects high-level metrics for EC2 instances, including disk usage, CPU utilization, and network activity.
- **Metrics Collected by the Agent:** The CloudWatch unified agent collects detailed metrics such as CPU utilization (active, guest, idle, system, user, steal), disk metrics (free, used, total), disk I/O (writes, reads, bytes, IOPS), RAM usage (free, inactive, used, total, cached), and more.

CloudWatch Logs for EC2 provides a robust solution for collecting and monitoring log data from EC2 instances. By installing the CloudWatch Logs agent and configuring IAM permissions, users can centralize log management and gain valuable insights into the performance and health of their EC2 instances. Additionally, the CloudWatch unified agent offers the capability to collect detailed system-level metrics, enhancing visibility and troubleshooting capabilities for EC2 instances.

# CloudWatch Alarms

**Overview:**
Amazon CloudWatch Alarms provide a powerful mechanism for monitoring metric data and triggering actions based on predefined thresholds. CloudWatch Alarms enable users to set up notifications, initiate auto-scaling actions, and perform instance recovery in response to changes in metric values. By defining alarms, users can proactively monitor the health and performance of their AWS resources and take appropriate actions to maintain operational efficiency and reliability.

**Key Features:**
- **Metric-Based Triggering:** CloudWatch Alarms trigger actions based on changes in metric values, allowing users to monitor the performance and health of their AWS resources.
- **Actions:** Alarms can trigger various actions, including stopping, terminating, rebooting, or recovering EC2 instances, initiating auto-scaling actions, and sending notifications to Amazon SNS topics.
- **Composite Alarms:** Users can create composite alarms that combine multiple other alarms, enabling complex logic using AND or OR conditions.
- **Instance Recovery:** CloudWatch Alarms can trigger instance recovery actions based on instance and system status checks. Automatic recovery includes restarting instances with the same private and public IP addresses, Elastic IP addresses, metadata, and placement group.
- **Testing:** Users can test alarms and notifications by manually setting the alarm state to "alarm" using the AWS Command Line Interface (CLI) and verifying if the alarm is triggered as expected.
- **Example Use Case:** An alarm could be set to terminate instances when breached, helping to manage costs or respond to sudden increases in demand.

CloudWatch Alarms play a crucial role in AWS monitoring and management, providing users with real-time insights into the health and performance of their resources. By setting up alarms and defining appropriate actions, users can proactively respond to changes in their environment, ensuring optimal performance, availability, and cost efficiency.

# Amazon EventBridge

**Overview:**
Amazon EventBridge is a serverless event bus service provided by AWS that simplifies event-driven architectures. It enables users to build event-driven workflows and applications by routing events from various sources to targets such as AWS Lambda functions, Amazon SNS topics, Amazon SQS queues, and more. With EventBridge, users can create rules to filter and route events based on specific criteria, allowing for flexible event processing and integration across AWS services and third-party applications.

**Key Features:**
- **Event-Driven Workflows:** EventBridge facilitates the creation of event-driven workflows and applications, enabling seamless integration and automation of business processes.
- **Event Rules:** Users can define event rules that specify the source event, optional filters, and target(s) for processing. This allows for granular control over event routing and processing.
- **Default Event Bus:** EventBridge includes a default event bus that receives events from AWS services and custom sources.
- **Partner Event Bus:** Partner applications can send events to EventBridge via partner event buses, enabling integration with third-party services such as Zendesk, Datadog, and more.
- **Custom Event Bus:** Users can create custom event buses to organize and route events within their environment. This allows for isolation and separation of event processing logic.
- **Archived Events:** EventBridge retains a history of events, allowing users to replay archived events for auditing, testing, or troubleshooting purposes.
- **Schema Registry:** EventBridge provides a schema registry to define event schemas and infer schema structures from event payloads. This simplifies event processing and integration by ensuring consistent data formats.
- **Resource-Based Policies:** Users can manage permissions for specific event buses using resource-based policies. This allows for fine-grained access control, including allowing or denying events from other AWS accounts or regions.
- **Integration with CloudWatch Events:** EventBridge replaces CloudWatch Events as the primary event bus service, offering enhanced features and capabilities for event-driven architectures.

Amazon EventBridge provides a scalable and flexible platform for building event-driven applications and workflows. By leveraging event rules, custom event buses, partner integrations, and other features, users can design sophisticated event-driven architectures that automate processes, streamline workflows, and integrate seamlessly with AWS services and third-party applications.

# CloudWatch Insights and Operational Visibility

**Overview:**
Amazon CloudWatch Insights and Operational Visibility features offer advanced monitoring and analysis capabilities for AWS resources, providing users with enhanced visibility into their environments and applications. With features such as Container Insights, Lambda Insights, Contributor Insights, and Application Insights, users can aggregate, analyze, and visualize log and metric data to gain actionable insights, troubleshoot issues, and optimize performance.

**Key Features:**
- **Container Insights:** CloudWatch Container Insights aggregates logs from containerized environments such as Amazon ECS, Amazon EKS, and AWS Fargate. It utilizes containerized versions of CloudWatch agents to collect and centralize log data for analysis.
- **Lambda Insights:** Monitoring Lambda functions is simplified with Lambda Insights, which provides Lambda-specific metrics and creates Lambda Insights dashboards for visualization and analysis.
- **Contributor Insights:** Contributor Insights allows users to identify top contributors to metrics such as request count, latency, and error count. This feature is valuable for identifying key contributors to performance issues or errors.
- **AWS-Generated Logs:** CloudWatch Insights works with any AWS-generated logs, including VPC logs and DNS logs. Users can perform advanced queries and analysis to identify patterns, trends, and anomalies in log data.
- **Example Use Cases:** CloudWatch Insights can be used to identify bad hosts in VPC logs or pinpoint the heaviest network users to troubleshoot performance issues. It can also be used to analyze URLs generating the most errors.
- **Application Insights:** CloudWatch Application Insights provides enhanced visibility into applications running on EC2 instances with select technologies. It can be linked to other AWS resources such as EBS, RDS, ELB, and ASG, and is powered by SageMaker for advanced analysis. All alerts generated by Application Insights can be sent to Amazon EventBridge for further processing or automation.

CloudWatch Insights and Operational Visibility features empower users to proactively monitor, analyze, and optimize their AWS environments and applications. By leveraging advanced analytics, visualization tools, and integrations with other AWS services, users can gain actionable insights, troubleshoot issues, and improve performance and reliability. These features enable organizations to maintain operational excellence and deliver superior customer experiences.

# CloudTrail: Enhancing Governance and Compliance in AWS

- **Purpose:** Governance, compliance, and audit for AWS accounts.
- **Activation:** Active by default.
- **Log Storage:** Logs stored in either S3 or CloudWatch.
- **Regional Accumulation:** Logs can accumulate from all regions or a single region.
- **Logging Scope:** All calls to AWS API are logged into CloudTrail.
- **Event Types:**
  - *Management Events:* Operations on AWS resources.
  - *Read and Write Events:* Read events (no modification) and write events (modification).
  - *Data Events:* Not logged on S3 (e.g., Get/Put/Delete object), but can be activated.
  - *Lambda Function Execution:* Not logged by default.
- **CloudTrail Insights:**
  - Analyzes events to find anomalies.
  - Continuously analyzes write events for unusual patterns.
- **Event Retention:** Default retention is 90 days; for longer retention, store logs in S3 and use Athena for analysis.

**Key Points:**
- CloudTrail ensures governance, compliance, and audit for AWS accounts.
- It is enabled automatically upon AWS account creation.
- Logs can be stored in either S3 or CloudWatch.
- Logging can be set up to cover all regions or specific ones.
- All AWS API calls are logged, including management, read, and write events.
- Data events, such as Get/Put/Delete object, are not logged on S3 by default but can be activated.
- Lambda function execution activities are not logged by default.
- CloudTrail Insights provide analysis for anomaly detection and continuous monitoring of write events.
- Default event retention is 90 days, but for longer retention, logs can be stored in S3 for analysis using Athena.

# EventBridge + CloudTrail: Intercepting API Calls

- **Process Overview:**
  - When a user action, like deleting a table in DynamoDB, occurs.
  - The call is logged into CloudTrail.
  - The event is then forwarded to EventBridge.
  - A rule is created in EventBridge to trigger an alert via SNS.

- **Workflow:**
  - User initiates action (e.g., deleting a table in DynamoDB).
  - API call is logged into CloudTrail.
  - Event is transmitted to EventBridge.
  - A rule in EventBridge triggers an alert via SNS.

- **Example Scenarios:**
  - **DynamoDB Table Deletion:**
    - User deletes a table in DynamoDB.
    - API call is logged into CloudTrail.
    - Event is sent to EventBridge.
    - EventBridge rule detects the action and triggers an alert via SNS.
  
  - **Security Group Edit:**
    - User edits an inbound security group.
    - API call is logged into CloudTrail.
    - Event is transmitted to EventBridge.
    - EventBridge rule identifies the change and activates an alert through SNS.

- **Key Components:**
  - **User Action:** Initiates an action within AWS services.
  - **CloudTrail:** Logs API calls and actions within AWS.
  - **EventBridge:** Receives and processes events from CloudTrail.
  - **SNS:** Sends alerts based on EventBridge rules.

- **Implementation:**
  - User actions are logged by CloudTrail.
  - Events are forwarded to EventBridge for processing.
  - EventBridge rules are configured to trigger alerts via SNS based on specific events.

- **Benefits:**
  - Real-time monitoring of user actions within AWS.
  - Automated alerting for critical events.
  - Enhanced security and compliance through proactive event monitoring.

**# AWS Config: Auditing and Compliance Monitoring**

AWS Config is a service designed to facilitate auditing and ensure compliance within your AWS infrastructure. Here's an overview of its functionalities:

- **Auditing and Compliance Recording:** Tracks and records configurations and changes over time, aiding in compliance adherence.
- **Key Questions Answered:**
  - Identifies if there's unrestricted SSH access to security groups.
  - Determines if buckets have public access.
  - Tracks changes in ALB configurations over time.
- **Alerting Mechanism:** Receive SNS notifications for any changes detected within your AWS resources.
- **Regional Scope:** Operates on a per-region basis but can aggregate data across multiple regions and accounts.
- **Data Storage and Analysis:** Configuration data can be stored in S3 and analyzed using Athena for deeper insights.
- **Config Rules:**
  - Utilize over 75 pre-configured AWS managed rules.
  - Create custom rules tailored to specific requirements, such as evaluating EBS disk types or EC2 instance types.
  - Rules can be evaluated for each configuration change or at regular intervals.
  - Note: Config rules do not prevent actions but can alert on non-compliance.
- **Pricing:** No free tier available.
- **Security Group Configuration Viewing:** Allows viewing of security group configurations.
- **Remediation:** While denial isn't possible, non-compliant resources can be remediated using SSM automation documents. For example, ensuring IAM access keys are not older than 90 days.
- **Integration:** EventBridge notifications can be triggered for non-compliant AWS resources.
- **Example Rule:** If instances use a specific AMI, trigger an alarm in Config if this is not the case (non-compliant).

AWS Config empowers users with comprehensive auditing and compliance monitoring capabilities, enabling proactive management of AWS resource configurations.

**# CloudWatch vs. CloudTrail vs. Config**

**CloudWatch:**
- **Purpose:** Performance monitoring with metrics, including CPU and network usage, along with dashboards, events, alerting, and log aggregation.
- **Elastic Load Balancer Example:**
  - Monitor incoming connections metric.
  - Visualize error codes as percentages over time.
  - Create dashboards to assess load balancer performance.

**CloudTrail:**
- **Purpose:** Records API calls made within your AWS account by all users, allowing for granular tracking and auditing.
- **Elastic Load Balancer Example:**
  - Track changes to the load balancer made by users via API calls.

**Config:**
- **Purpose:** Records configuration changes, evaluates resources against compliance rules, and provides a timeline of changes and compliance status.
- **Elastic Load Balancer Example:**
  - Track security group rules for the load balancer.
  - Monitor configuration changes for the load balancer.
  - Ensure an SSL certificate is always assigned to the load balancer (compliance).

In summary, while CloudWatch focuses on performance monitoring and log aggregation, CloudTrail is dedicated to tracking API calls, and Config specializes in recording configuration changes and ensuring compliance with defined rules. Each service plays a crucial role in managing and securing AWS resources, including Elastic Load Balancers, offering complementary functionalities for comprehensive monitoring, auditing, and governance.
